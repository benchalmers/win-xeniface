From a4dcb20d757d4ce1c1a5b505363bfbfcb2bed11d Mon Sep 17 00:00:00 2001
From: Paul Durrant <paul.durrant@citrix.com>
Date: Thu, 4 Aug 2016 11:02:23 +0100
Subject: [PATCH] Work around XAPI using 'halt' rather then 'poweroff'

XAPI uses the wrong value of control/shutdown to shut down a VM

Signed-off-by: Paul Durrant <paul.durrant@citrix.com>
---
 src/xenagent/service.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/xenagent/service.cpp b/src/xenagent/service.cpp
index 5b49218..2670ac0 100644
--- a/src/xenagent/service.cpp
+++ b/src/xenagent/service.cpp
@@ -513,7 +513,7 @@ bool CXenAgent::CheckShutdown()
 
     CXenAgent::Log("Shutdown(%ws) = %s\n", m_device->Path(), type.c_str());
 
-    if (type == "poweroff") {
+    if (type == "poweroff" || type == "halt") {
         EventLog(EVENT_XENUSER_POWEROFF);
 
         m_device->StoreWrite("control/shutdown", "");
-- 
2.5.3

