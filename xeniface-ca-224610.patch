From 2f51045600852d3f8d43cc9138eef294ed711dc1 Mon Sep 17 00:00:00 2001
From: Owen Smith <owen.smith@citrix.com>
Date: Tue, 4 Oct 2016 16:43:30 +0100
Subject: [PATCH] [CA-224610] Ignore formatting in STORE Printf strings

Use hard coded format string, dont just accept input string
which may contain format specifiers

Signed-off-by: Owen Smith <owen.smith@citrix.com>
---
 src/xeniface/ioctl_store.c | 2 +-
 src/xeniface/wmi.c         | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/xeniface/ioctl_store.c b/src/xeniface/ioctl_store.c
index 5bd4649..02d4455 100644
--- a/src/xeniface/ioctl_store.c
+++ b/src/xeniface/ioctl_store.c
@@ -177,7 +177,7 @@ IoctlStoreWrite(
     if (!__IsValidStr(Value, InLen - Length))
         goto fail3;
 
-    status = XENBUS_STORE(Printf, &Fdo->StoreInterface, NULL, NULL, Buffer, Value);
+    status = XENBUS_STORE(Printf, &Fdo->StoreInterface, NULL, NULL, Buffer, "%s", Value);
     if (!NT_SUCCESS(status))
         goto fail4;
 
diff --git a/src/xeniface/wmi.c b/src/xeniface/wmi.c
index b3e4c55..8777e25 100644
--- a/src/xeniface/wmi.c
+++ b/src/xeniface/wmi.c
@@ -1682,7 +1682,7 @@ SessionExecuteSetValue(UCHAR *InBuffer,
             NULL){
         goto fail4;
     }
-    status = XENBUS_STORE(Printf, &fdoData->StoreInterface, session->transaction, NULL, tmppath, tmpvalue);
+    status = XENBUS_STORE(Printf, &fdoData->StoreInterface, session->transaction, NULL, tmppath, "%s", tmpvalue);
     XenIfaceDebugPrint(TRACE, " Write %s to %s (%p)\n", tmpvalue, tmppath, status);
     UnlockSessions(fdoData);
 
-- 
2.8.3

